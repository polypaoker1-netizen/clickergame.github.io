<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISA CLICKER</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* –°–Ω–µ–≥ */
        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 20px;
            pointer-events: none;
            z-index: 1000;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); }
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* –ú–æ–¥–∞–ª–∫–∞ –≤—Ö–æ–¥–∞ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            border: 3px solid #e94560;
            text-align: center;
        }
        
        .modal h2 {
            color: #e94560;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .modal p {
            margin-bottom: 20px;
            opacity: 0.9;
        }
        
        .modal-input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #0f3460;
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }
        
        .modal-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.3s;
        }
        
        .modal-btn:hover {
            transform: translateY(-3px);
        }
        
        .channel-link {
            display: block;
            background: rgba(0,123,255,0.2);
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            text-decoration: none;
            color: #00ccff;
            font-weight: bold;
        }
        
        .checkbox {
            display: flex;
            align-items: center;
            margin: 15px 0;
            text-align: left;
        }
        
        .checkbox input {
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }
        
        .error {
            color: #ff6b6b;
            margin: 10px 0;
            display: none;
        }
        
        /* –ò–≥—Ä–æ–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .game-interface {
            display: none;
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #e94560;
            cursor: pointer;
        }
        
        .top-menu {
            display: flex;
            gap: 10px;
        }
        
        .top-btn {
            padding: 10px 15px;
            background: rgba(255,255,255,0.15);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #ffd700;
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä—ã */
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
        }
        
        .xp-bar { background: linear-gradient(90deg, #00ff88, #00ccff); }
        .energy-bar { background: linear-gradient(90deg, #ffd700, #ff6b6b); }
        
        /* –ö–ª–∏–∫–µ—Ä */
        .clicker {
            text-align: center;
            margin: 30px 0;
        }
        
        .click-area {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #ff4757, #ff3838);
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 50px rgba(255,71,87,0.5);
            transition: transform 0.1s;
            user-select: none;
        }
        
        .click-area:active {
            transform: scale(0.95);
            box-shadow: 0 0 80px rgba(255,71,87,0.8);
        }
        
        .click-effect {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            pointer-events: none;
            animation: pulse 0.5s;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        /* –ò–Ω—Ñ–æ –ø–æ–¥ –∫–ª–∏–∫–µ—Ä–æ–º */
        .clicker-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }
        
        .info-item {
            text-align: center;
        }
        
        .info-value {
            font-size: 20px;
            font-weight: bold;
            color: #00ff88;
        }
        
        .info-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è */
        .upgrades {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .upgrades h3 {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upgrade-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .upgrade-btn {
            background: linear-gradient(90deg, #ffa500, #ff6b6b);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* –ú–µ–Ω—é */
        .menu {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .menu-btn {
            padding: 15px 10px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .menu-btn i {
            font-size: 20px;
        }
        
        /* –°–µ–∫—Ü–∏–∏ */
        .section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: none;
        }
        
        /* –ü–æ–¥–∞—Ä–æ–∫ */
        .gift {
            position: fixed;
            width: 70px;
            height: 70px;
            background: radial-gradient(circle, gold, orange);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 30px gold;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            color: black;
            padding: 15px 25px;
            border-radius: 15px;
            z-index: 1001;
            animation: slideIn 0.5s;
            display: none;
            font-weight: bold;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        /* –†–µ—Å–ø–æ–Ω—Å–∏–≤ */
        @media (max-width: 480px) {
            .container { padding: 10px; }
            .header { flex-direction: column; gap: 10px; }
            .click-area { width: 150px; height: 150px; }
            .menu { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- –°–Ω–µ–≥ -->
    <div id="snow"></div>
    
    <!-- –ú–æ–¥–∞–ª–∫–∞ –≤—Ö–æ–¥–∞ -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>‚ùÑÔ∏è VISA CLICKER ‚ùÑÔ∏è</h2>
            <p>–ß—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å, –ø–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª –∏ –ø—Ä–∏–¥—É–º–∞–π –Ω–∏–∫–Ω–µ–π–º!</p>
            
            <input type="text" id="usernameInput" class="modal-input" placeholder="–¢–≤–æ–π –Ω–∏–∫–Ω–µ–π–º" maxlength="20">
            <div id="usernameError" class="error"></div>
            
            <a href="https://t.me/visaclicker" target="_blank" class="channel-link">
                üì¢ –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è: @visaclicker
            </a>
            
            <div class="checkbox">
                <input type="checkbox" id="subscribeCheck">
                <label>–Ø –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –∫–∞–Ω–∞–ª</label>
            </div>
            
            <button class="modal-btn" onclick="registerUser()">
                üéÆ –ù–ê–ß–ê–¢–¨ –ò–ì–†–ê–¢–¨
            </button>
            
            <div id="registerError" class="error"></div>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∞—Ä–æ–∫ -->
    <div class="gift" id="gift" onclick="collectGift()">üéÅ</div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification"></div>
    
    <!-- –ò–≥—Ä–∞ -->
    <div id="gameInterface" class="game-interface">
        <div class="container">
            <!-- –®–∞–ø–∫–∞ -->
            <div class="header">
                <div class="logo" onclick="window.open('https://t.me/visaclicker', '_blank')">
                    VISA CLICKER
                </div>
                <div class="top-menu">
                    <button class="top-btn" onclick="openFortune()">üé° –ö–æ–ª–µ—Å–æ</button>
                    <button class="top-btn" onclick="openShop()">üè™ –ú–∞–≥–∞–∑–∏–Ω</button>
                    <button class="top-btn" onclick="showReferral()">
                        üë• <span id="refCount">0</span>
                    </button>
                </div>
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">VISA</div>
                    <div class="stat-value" id="visaCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–£–†–û–í–ï–ù–¨</div>
                    <div class="stat-value" id="levelCount">1</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ö–õ–ò–ö–û–í</div>
                    <div class="stat-value" id="clicksCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ü–û–î–ê–†–ö–û–í</div>
                    <div class="stat-value" id="giftsCount">0</div>
                </div>
            </div>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä—ã -->
            <div class="progress-container">
                <div class="progress-label">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è</span>
                    <span id="xpText">0/100 XP</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill xp-bar" id="xpBar" style="width: 0%"></div>
                </div>
                
                <div class="progress-label" style="margin-top: 15px;">
                    <span>‚ö° –≠–ù–ï–†–ì–ò–Ø</span>
                    <span id="energyText">50/50</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill energy-bar" id="energyBar" style="width: 100%"></div>
                </div>
            </div>
            
            <!-- –ö–ª–∏–∫–µ—Ä -->
            <div class="clicker">
                <div class="click-area" onclick="handleClick(event)" id="clickArea">
                    –ö–õ–ò–ö–ê–ô!
                </div>
                <div class="clicker-info">
                    <div class="info-item">
                        <div class="info-value" id="powerValue">x5</div>
                        <div class="info-label">–°–∏–ª–∞ –∫–ª–∏–∫–∞</div>
                    </div>
                    <div class="info-item">
                        <div class="info-value" id="autoValue">0</div>
                        <div class="info-label">–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã</div>
                    </div>
                    <div class="info-item">
                        <div class="info-value" id="chanceValue">0.5%</div>
                        <div class="info-label">–®–∞–Ω—Å –ø–æ–¥–∞—Ä–∫–∞</div>
                    </div>
                </div>
            </div>
            
            <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
            <div class="upgrades" id="upgradesSection">
                <h3><i class="fas fa-rocket"></i> –£–õ–£–ß–®–ï–ù–ò–Ø</h3>
                <div class="upgrade-item">
                    <div>
                        <div style="font-weight: bold;">üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞</div>
                        <div style="font-size: 12px;">–¢–µ–∫—É—â–∞—è: <span id="clickPower">x5</span></div>
                    </div>
                    <button class="upgrade-btn" onclick="buyUpgrade('click')" id="clickBtn">
                        500 VISA
                    </button>
                </div>
                <div class="upgrade-item">
                    <div>
                        <div style="font-weight: bold;">‚ö° –Å–º–∫–æ—Å—Ç—å —ç–Ω–µ—Ä–≥–∏–∏</div>
                        <div style="font-size: 12px;">–ú–∞–∫—Å: <span id="maxEnergy">50</span></div>
                    </div>
                    <button class="upgrade-btn" onclick="buyUpgrade('energy')" id="energyBtn">
                        800 VISA
                    </button>
                </div>
                <div class="upgrade-item">
                    <div>
                        <div style="font-weight: bold;">üéÅ –®–∞–Ω—Å –ø–æ–¥–∞—Ä–∫–∞</div>
                        <div style="font-size: 12px;">–¢–µ–∫—É—â–∏–π: <span id="giftChance">0.5%</span></div>
                    </div>
                    <button class="upgrade-btn" onclick="buyUpgrade('chance')" id="chanceBtn">
                        1200 VISA
                    </button>
                </div>
            </div>
            
            <!-- –ú–µ–Ω—é -->
            <div class="menu">
                <button class="menu-btn active" onclick="showSection('upgrades')">
                    <i class="fas fa-rocket"></i>
                    <span>–£–ª—É—á—à–µ–Ω–∏—è</span>
                </button>
                <button class="menu-btn" onclick="showSection('inventory')">
                    <i class="fas fa-backpack"></i>
                    <span>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
                </button>
                <button class="menu-btn" onclick="showSection('top')">
                    <i class="fas fa-trophy"></i>
                    <span>–¢–æ–ø</span>
                </button>
                <button class="menu-btn" onclick="showSection('referral')">
                    <i class="fas fa-users"></i>
                    <span>–†–µ—Ñ–µ—Ä–∞–ª—ã</span>
                </button>
                <button class="menu-btn" onclick="showSection('stats')">
                    <i class="fas fa-chart-bar"></i>
                    <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                </button>
                <button class="menu-btn" onclick="exitGame()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>–í—ã—Ö–æ–¥</span>
                </button>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
            <div class="section" id="inventorySection">
                <h3><i class="fas fa-backpack"></i> –ò–ù–í–ï–ù–¢–ê–†–¨</h3>
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 48px; margin: 20px 0;">üéÅ</div>
                    <h4>–ü–æ–¥–∞—Ä–∫–æ–≤ —Å–æ–±—Ä–∞–Ω–æ: <span id="totalGifts">0</span></h4>
                    <p style="margin: 15px 0; opacity: 0.8;">
                        –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∞—Ä–∫–æ–≤ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ!
                    </p>
                    <button class="top-btn" onclick="showNotify('–§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!')">
                        –ü–û–ö–ê–ó–ê–¢–¨ –ú–û–ò –ü–û–î–ê–†–ö–ò
                    </button>
                </div>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è —Ç–æ–ø–∞ -->
            <div class="section" id="topSection">
                <h3><i class="fas fa-trophy"></i> –¢–û–ü –ò–ì–†–û–ö–û–í</h3>
                <div id="topList" style="text-align: center; padding: 20px;">
                    –ó–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ -->
            <div class="section" id="referralSection">
                <h3><i class="fas fa-users"></i> –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –°–ò–°–¢–ï–ú–ê</h3>
                <div style="text-align: center; padding: 20px;">
                    <div style="background: rgba(0,255,136,0.2); padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <h4 style="color: #00ff88;">üéØ –ü—Ä–∏–≤–µ–¥–∏ –¥—Ä—É–≥–∞ - –ø–æ–ª—É—á–∏ 100 VISA!</h4>
                        <p>–ó–∞ –∫–∞–∂–¥–æ–≥–æ –¥—Ä—É–≥–∞ –ø–æ–ª—É—á–∞–µ—à—å 100 VISA</p>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <p>–¢–≤–æ—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</p>
                        <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; margin: 10px 0; font-size: 14px;">
                            https://polypacker1-netizen.github.io/clickergame/?ref=<span id="userRefCode">000</span>
                        </div>
                        <button class="top-btn" onclick="copyRefLink()">
                            <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <div class="section" id="statsSection">
                <h3><i class="fas fa-chart-bar"></i> –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3>
                <div style="padding: 15px;">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div>–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤:</div>
                        <div><span id="statClicks">0</span></div>
                        
                        <div>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ VISA:</div>
                        <div><span id="statVisa">0</span></div>
                        
                        <div>–®–∞–Ω—Å –ø–æ–¥–∞—Ä–∫–∞:</div>
                        <div><span id="statChance">0.5%</span></div>
                        
                        <div>–ú–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è:</div>
                        <div><span id="statEnergy">50</span></div>
                        
                        <div>–†–µ—Ñ–µ—Ä–∞–ª–æ–≤:</div>
                        <div><span id="statRefs">0</span></div>
                        
                        <div>–í—Ä–µ–º—è –∏–≥—Ä—ã:</div>
                        <div><span id="statTime">0 –º–∏–Ω</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let gameData = {
            username: '',
            userId: '',
            visa: 50,
            level: 1,
            xp: 0,
            xpNeeded: 100,
            energy: 50,
            maxEnergy: 50,
            clicks: 0,
            totalClicks: 0,
            gifts: 0,
            referrals: 0,
            clickPower: 5,
            autoClickers: 0,
            giftChance: 0.005,
            upgrades: {
                click: { level: 1, cost: 500 },
                energy: { level: 1, cost: 800 },
                chance: { level: 1, cost: 1200 }
            },
            lastEnergyUpdate: Date.now(),
            referralCode: '',
            referredBy: '',
            startTime: Date.now()
        };
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get('ref');
        
        // –°–Ω–µ–≥
        function createSnow() {
            const snowContainer = document.getElementById('snow');
            for(let i = 0; i < 30; i++) {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.innerHTML = '‚ùÑ';
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.opacity = Math.random() * 0.7 + 0.3;
                snowContainer.appendChild(snowflake);
            }
        }
        
        // –≠—Ñ—Ñ–µ–∫—Ç –∫–ª–∏–∫–∞
        function createClickEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.style.left = (x - 25) + 'px';
            effect.style.top = (y - 25) + 'px';
            document.getElementById('clickArea').appendChild(effect);
            
            setTimeout(() => effect.remove(), 500);
        }
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotify(text, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = text;
            
            if(type === 'error') {
                notification.style.background = 'linear-gradient(90deg, #ff6b6b, #ff3838)';
            } else if(type === 'success') {
                notification.style.background = 'linear-gradient(90deg, #00ff88, #00ccff)';
            } else if(type === 'gift') {
                notification.style.background = 'linear-gradient(90deg, gold, orange)';
                notification.style.color = 'black';
            }
            
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser() {
            const usernameInput = document.getElementById('usernameInput');
            const username = usernameInput.value.trim();
            const subscribed = document.getElementById('subscribeCheck').checked;
            const errorDiv = document.getElementById('usernameError');
            
            errorDiv.style.display = 'none';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if(!username) {
                errorDiv.textContent = '–í–≤–µ–¥–∏ –Ω–∏–∫–Ω–µ–π–º!';
                errorDiv.style.display = 'block';
                return;
            }
            
            if(username.length < 3) {
                errorDiv.textContent = '–ù–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 3 —Å–∏–º–≤–æ–ª–æ–≤';
                errorDiv.style.display = 'block';
                return;
            }
            
            if(!subscribed) {
                showNotify('–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª!', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∏–∫ –≤ localStorage
            const existingUsers = JSON.parse(localStorage.getItem('visaclicker_users') || '{}');
            
            if(existingUsers[username.toLowerCase()]) {
                errorDiv.textContent = '–≠—Ç–æ—Ç –Ω–∏–∫ —É–∂–µ –∑–∞–Ω—è—Ç!';
                errorDiv.style.display = 'block';
                return;
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º
            const userId = 'user_' + Date.now();
            const referralCode = Math.random().toString(36).substr(2, 6).toUpperCase();
            
            gameData.username = username;
            gameData.userId = userId;
            gameData.referralCode = referralCode;
            gameData.startTime = Date.now();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            existingUsers[username.toLowerCase()] = {
                userId: userId,
                visa: gameData.visa,
                level: gameData.level,
                referrals: gameData.referrals,
                clicks: gameData.totalClicks,
                gifts: gameData.gifts,
                registered: Date.now()
            };
            
            localStorage.setItem('visaclicker_users', JSON.stringify(existingUsers));
            localStorage.setItem('visaclicker_current_user', JSON.stringify(gameData));
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'block';
            
            // –°–Ω–µ–≥
            createSnow();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUI();
            loadTopPlayers();
            
            showNotify(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}!`, 'success');
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
        function handleClick(event) {
            if(gameData.energy <= 0) {
                showNotify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'error');
                return;
            }
            
            // –≠—Ñ—Ñ–µ–∫—Ç
            createClickEffect(event.clientX, event.clientY);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            gameData.clicks++;
            gameData.totalClicks++;
            gameData.visa += gameData.clickPower;
            gameData.xp += 2;
            
            // –≠–Ω–µ—Ä–≥–∏—è (1 –Ω–∞ 10 –∫–ª–∏–∫–æ–≤)
            if(gameData.clicks % 10 === 0) {
                gameData.energy = Math.max(0, gameData.energy - 1);
            }
            
            // –£—Ä–æ–≤–µ–Ω—å
            if(gameData.xp >= gameData.xpNeeded) {
                gameData.level++;
                gameData.xp = 0;
                gameData.xpNeeded = Math.floor(gameData.xpNeeded * 1.5);
                showNotify(`üéâ –£—Ä–æ–≤–µ–Ω—å ${gameData.level}!`, 'success');
            }
            
            // –®–∞–Ω—Å –ø–æ–¥–∞—Ä–∫–∞ (0.5%)
            if(Math.random() < gameData.giftChance) {
                showGift();
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            saveGame();
            updateUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫
        function showGift() {
            const gift = document.getElementById('gift');
            gift.style.display = 'flex';
            gift.style.left = Math.random() * 70 + 15 + '%';
            gift.style.top = Math.random() * 70 + 15 + '%';
            
            showNotify('üéÅ –ü–æ—è–≤–∏–ª—Å—è –ø–æ–¥–∞—Ä–æ–∫! –ö–ª–∏–∫–Ω–∏!', 'gift');
            
            setTimeout(() => {
                if(gift.style.display !== 'none') {
                    gift.style.display = 'none';
                    showNotify('–ü–æ–¥–∞—Ä–æ–∫ –∏—Å—á–µ–∑!', 'error');
                }
            }, 5000);
        }
        
        // –°–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫
        function collectGift() {
            const gift = document.getElementById('gift');
            gift.style.display = 'none';
            
            // –¢–∏–ø –Ω–∞–≥—Ä–∞–¥—ã
            const rand = Math.random();
            
            if(rand < 0.7) {
                // VISA
                const amount = Math.floor(Math.random() * 100) + 50;
                gameData.visa += amount;
                showNotify(`üéÅ +${amount} VISA!`, 'success');
            } else if(rand < 0.9) {
                // –£–ª—É—á—à–µ–Ω–∏–µ
                gameData.clickPower++;
                showNotify(`üéÅ –°–∏–ª–∞ –∫–ª–∏–∫–∞ +1!`, 'success');
            } else {
                // –ü—Ä–µ–¥–º–µ—Ç
                gameData.gifts++;
                showNotify(`üéÅ –†–µ–¥–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç! –í—Å–µ–≥–æ: ${gameData.gifts}`, 'gift');
            }
            
            saveGame();
            updateUI();
        }
        
        // –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è
        function buyUpgrade(type) {
            const upgrade = gameData.upgrades[type];
            
            if(gameData.visa < upgrade.cost) {
                showNotify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ VISA!', 'error');
                return;
            }
            
            gameData.visa -= upgrade.cost;
            
            switch(type) {
                case 'click':
                    gameData.clickPower += 2;
                    upgrade.level++;
                    upgrade.cost = Math.floor(upgrade.cost * 2);
                    showNotify(`üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞: x${gameData.clickPower}`, 'success');
                    break;
                    
                case 'energy':
                    gameData.maxEnergy += 10;
                    gameData.energy = gameData.maxEnergy;
                    upgrade.level++;
                    upgrade.cost = Math.floor(upgrade.cost * 1.8);
                    showNotify(`‚ö° –≠–Ω–µ—Ä–≥–∏—è: ${gameData.maxEnergy}`, 'success');
                    break;
                    
                case 'chance':
                    gameData.giftChance += 0.001;
                    upgrade.level++;
                    upgrade.cost = Math.floor(upgrade.cost * 2.2);
                    showNotify(`üéÅ –®–∞–Ω—Å: ${(gameData.giftChance*100).toFixed(2)}%`, 'success');
                    break;
            }
            
            saveGame();
            updateUI();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
        function updateEnergy() {
            const now = Date.now();
            const timeDiff = (now - gameData.lastEnergyUpdate) / 1000 / 60; // –º–∏–Ω—É—Ç—ã
            
            if(timeDiff > 0) {
                // 50 —ç–Ω–µ—Ä–≥–∏–∏ –∑–∞ 20 –º–∏–Ω—É—Ç
                const energyGain = Math.floor((timeDiff / 20) * gameData.maxEnergy);
                if(energyGain > 0) {
                    gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + energyGain);
                    gameData.lastEnergyUpdate = now;
                }
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            localStorage.setItem('visaclicker_current_user', JSON.stringify(gameData));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –æ–±—â–µ–º —Å–ø–∏—Å–∫–µ
            const existingUsers = JSON.parse(localStorage.getItem('visaclicker_users') || '{}');
            if(existingUsers[gameData.username.toLowerCase()]) {
                existingUsers[gameData.username.toLowerCase()] = {
                    userId: gameData.userId,
                    visa: gameData.visa,
                    level: gameData.level,
                    referrals: gameData.referrals,
                    clicks: gameData.totalClicks,
                    gifts: gameData.gifts,
                    registered: Date.now()
                };
                localStorage.setItem('visaclicker_users', JSON.stringify(existingUsers));
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            updateEnergy();
            
            // –û—Å–Ω–æ–≤–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            document.getElementById('visaCount').textContent = gameData.visa;
            document.getElementById('levelCount').textContent = gameData.level;
            document.getElementById('clicksCount').textContent = gameData.totalClicks;
            document.getElementById('giftsCount').textContent = gameData.gifts;
            document.getElementById('refCount').textContent = gameData.referrals;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å
            const xpPercent = (gameData.xp / gameData.xpNeeded) * 100;
            document.getElementById('xpBar').style.width = xpPercent + '%';
            document.getElementById('xpText').textContent = `${gameData.xp}/${gameData.xpNeeded} XP`;
            
            // –≠–Ω–µ—Ä–≥–∏—è
            const energyPercent = (gameData.energy / gameData.maxEnergy) * 100;
            document.getElementById('energyBar').style.width = energyPercent + '%';
            document.getElementById('energyText').textContent = `${gameData.energy}/${gameData.maxEnergy}`;
            
            // –£–ª—É—á—à–µ–Ω–∏—è
            document.getElementById('clickPower').textContent = `x${gameData.clickPower}`;
            document.getElementById('maxEnergy').textContent = gameData.maxEnergy;
            document.getElementById('giftChance').textContent = (gameData.giftChance*100).toFixed(2) + '%';
            
            // –ö–Ω–æ–ø–∫–∏
            document.getElementById('clickBtn').textContent = gameData.upgrades.click.cost + ' VISA';
            document.getElementById('energyBtn').textContent = gameData.upgrades.energy.cost + ' VISA';
            document.getElementById('chanceBtn').textContent = gameData.upgrades.chance.cost + ' VISA';
            
            // –ò–Ω—Ñ–æ
            document.getElementById('powerValue').textContent = `x${gameData.clickPower}`;
            document.getElementById('chanceValue').textContent = (gameData.giftChance*100).toFixed(2) + '%';
            document.getElementById('autoValue').textContent = gameData.autoClickers;
            
            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
            document.getElementById('totalGifts').textContent = gameData.gifts;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const playTime = Math.floor((Date.now() - gameData.startTime) / 1000 / 60);
            document.getElementById('statClicks').textContent = gameData.totalClicks;
            document.getElementById('statVisa').textContent = gameData.visa;
            document.getElementById('statChance').textContent = (gameData.giftChance*100).toFixed(2) + '%';
            document.getElementById('statEnergy').textContent = gameData.maxEnergy;
            document.getElementById('statRefs').textContent = gameData.referrals;
            document.getElementById('statTime').textContent = playTime + ' –º–∏–Ω';
            
            // –†–µ—Ñ–µ—Ä–∞–ª—ã
            document.getElementById('userRefCode').textContent = gameData.referralCode;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø–∞
        function loadTopPlayers() {
            const existingUsers = JSON.parse(localStorage.getItem('visaclicker_users') || '{}');
            const topList = document.getElementById('topList');
            
            if(Object.keys(existingUsers).length === 0) {
                topList.innerHTML = '<p style="opacity: 0.7;">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ VISA
            const usersArray = Object.values(existingUsers);
            usersArray.sort((a, b) => b.visa - a.visa);
            
            let html = '';
            const medals = ['ü•á', 'ü•à', 'ü•â', '4.', '5.'];
            
            usersArray.slice(0, 5).forEach((user, index) => {
                const username = Object.keys(existingUsers).find(key => 
                    existingUsers[key].userId === user.userId
                );
                
                html += `
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 10px; margin: 5px 0; display: flex; justify-content: space-between;">
                        <div>
                            <span style="font-size: 18px;">${medals[index] || (index+1+'.')}</span>
                            <span style="margin-left: 10px; font-weight: bold;">${username}</span>
                        </div>
                        <div style="color: #ffd700; font-weight: bold;">
                            ${user.visa} VISA
                        </div>
                    </div>
                `;
            });
            
            topList.innerHTML = html;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é
        function showSection(section) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ
            const sections = ['upgrades', 'inventory', 'top', 'referral', 'stats'];
            sections.forEach(sec => {
                document.getElementById(sec + 'Section').style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é
            if(section !== 'upgrades') {
                document.getElementById(section + 'Section').style.display = 'block';
                document.getElementById('upgradesSection').style.display = 'none';
            } else {
                document.getElementById('upgradesSection').style.display = 'block';
            }
            
            if(section === 'top') {
                loadTopPlayers();
            }
        }
        
        // –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã
        function openFortune() {
            showNotify('üé° –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã —Å–∫–æ—Ä–æ!', 'info');
        }
        
        // –ú–∞–≥–∞–∑–∏–Ω
        function openShop() {
            showNotify('üè™ –ú–∞–≥–∞–∑–∏–Ω –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!', 'info');
        }
        
        // –†–µ—Ñ–µ—Ä–∞–ª—ã
        function showReferral() {
            showSection('referral');
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
        function copyRefLink() {
            const link = `https://polypacker1-netizen.github.io/clickergame/?ref=${gameData.referralCode}`;
            navigator.clipboard.writeText(link);
            showNotify('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
        }
        
        // –í—ã—Ö–æ–¥
        function exitGame() {
            if(confirm('–í—ã–π—Ç–∏ –∏–∑ –∏–≥—Ä—ã?')) {
                localStorage.removeItem('visaclicker_current_user');
                location.reload();
            }
        }
        
        // –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã
        setInterval(() => {
            if(gameData.autoClickers > 0) {
                for(let i = 0; i < gameData.autoClickers; i++) {
                    if(gameData.energy > 0) {
                        gameData.visa += gameData.clickPower;
                        gameData.totalClicks++;
                        if(gameData.totalClicks % 10 === 0) {
                            gameData.energy--;
                        }
                    }
                }
                saveGame();
                updateUI();
            }
        }, 1000);
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
        setInterval(updateUI, 60000);
        
        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        setInterval(saveGame, 30000);
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã
        window.onload = function() {
            const savedUser = localStorage.getItem('visaclicker_current_user');
            
            if(savedUser) {
                try {
                    gameData = JSON.parse(savedUser);
                    document.getElementById('loginModal').style.display = 'none';
                    document.getElementById('gameInterface').style.display = 'block';
                    createSnow();
                    updateUI();
                    loadTopPlayers();
                } catch(e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                }
            }
        };
    </script>
</body>
</html>
