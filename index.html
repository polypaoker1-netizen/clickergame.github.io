<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISA CLICKER</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29, #302b63);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –Ω–∏–∫–∞ */
        #loginModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #1a1a2e;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 2px solid #e94560;
        }
        
        .modal-content h2 {
            color: #e94560;
            margin-bottom: 20px;
        }
        
        .modal-input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #0f3460;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }
        
        .modal-btn {
            width: 100%;
            padding: 15px;
            background: #e94560;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .modal-btn:hover {
            background: #ff6b6b;
        }
        
        .error {
            color: #ff6b6b;
            margin: 10px 0;
            display: none;
        }
        
        /* –ò–≥—Ä–∞ */
        #gameInterface {
            display: none;
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #e94560;
        }
        
        .user-info {
            font-size: 16px;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #ffd700;
            margin: 5px 0;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä—ã */
        .progress-bar {
            height: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 10px;
        }
        
        .xp-bar { background: linear-gradient(90deg, #00ff88, #00ccff); }
        .energy-bar { background: linear-gradient(90deg, #ffd700, #ff6b6b); }
        
        /* –ö–ª–∏–∫–µ—Ä */
        .clicker {
            text-align: center;
            margin: 20px 0;
        }
        
        .click-area {
            width: 180px;
            height: 180px;
            background: #e94560;
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 30px rgba(233,69,96,0.5);
            transition: transform 0.1s;
            user-select: none;
        }
        
        .click-area:active {
            transform: scale(0.95);
        }
        
        /* –£–ª—É—á—à–µ–Ω–∏—è */
        .upgrades {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .upgrade-item {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .upgrade-btn {
            background: #e94560;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        .upgrade-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        /* –ú–µ–Ω—é */
        .menu {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 15px 0;
        }
        
        .menu-btn {
            padding: 12px 8px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
        }
        
        .menu-btn:hover {
            background: rgba(255,255,255,0.2);
        }
        
        /* –°–µ–∫—Ü–∏–∏ */
        .section {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }
        
        /* –ü–æ–¥–∞—Ä–æ–∫ */
        .gift {
            position: fixed;
            width: 60px;
            height: 60px;
            background: gold;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 20px gold;
            animation: float 2s infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e94560;
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            z-index: 1001;
            animation: slideIn 0.3s;
            display: none;
            font-weight: bold;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –Ω–∏–∫–∞ -->
    <div id="loginModal">
        <div class="modal-content">
            <h2>üéÆ VISA CLICKER</h2>
            <p>–í–≤–µ–¥–∏ —Å–≤–æ–π –Ω–∏–∫–Ω–µ–π–º —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É</p>
            
            <input type="text" id="usernameInput" class="modal-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π –Ω–∏–∫" maxlength="20" autofocus>
            <div id="usernameError" class="error"></div>
            
            <button class="modal-btn" onclick="registerUser()">
                –ù–ê–ß–ê–¢–¨ –ò–ì–†–ê–¢–¨
            </button>
        </div>
    </div>
    
    <!-- –ü–æ–¥–∞—Ä–æ–∫ -->
    <div class="gift" id="gift" onclick="collectGift()">üéÅ</div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification"></div>
    
    <!-- –ò–≥—Ä–∞ -->
    <div id="gameInterface" class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="logo">VISA CLICKER</div>
            <div class="user-info">
                üë§ <span id="displayUsername">–ò–≥—Ä–æ–∫</span>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">VISA</div>
                <div class="stat-value" id="visaCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–£–†–û–í–ï–ù–¨</div>
                <div class="stat-value" id="levelCount">1</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ö–õ–ò–ö–û–í</div>
                <div class="stat-value" id="clicksCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ü–û–î–ê–†–ö–û–í</div>
                <div class="stat-value" id="giftsCount">0</div>
            </div>
        </div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
        <div>
            <div style="margin-bottom: 5px;">
                <span>–£—Ä–æ–≤–µ–Ω—å: </span>
                <span id="xpText">0/100</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill xp-bar" id="xpBar" style="width: 0%"></div>
            </div>
            
            <div style="margin: 15px 0 5px;">
                <span>‚ö° –≠–Ω–µ—Ä–≥–∏—è: </span>
                <span id="energyText">50/50</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill energy-bar" id="energyBar" style="width: 100%"></div>
            </div>
        </div>
        
        <!-- –ö–ª–∏–∫–µ—Ä -->
        <div class="clicker">
            <div class="click-area" onclick="handleClick()" id="clickArea">
                –ö–õ–ò–ö–ê–ô!
            </div>
            <div style="margin-top: 15px;">
                <div>–°–∏–ª–∞ –∫–ª–∏–∫–∞: <span id="powerValue" style="color: #00ff88;">x5</span></div>
                <div>–®–∞–Ω—Å –ø–æ–¥–∞—Ä–∫–∞: <span id="chanceValue" style="color: gold;">0.5%</span></div>
            </div>
        </div>
        
        <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
        <div class="upgrades" id="upgradesSection">
            <h3>–£–õ–£–ß–®–ï–ù–ò–Ø</h3>
            <div class="upgrade-item">
                <div>
                    <div style="font-weight: bold;">üí™ –°–∏–ª–∞ –∫–ª–∏–∫–∞</div>
                    <div style="font-size: 12px;">–¢–µ–∫—É—â–∞—è: x<span id="clickPower">5</span></div>
                </div>
                <button class="upgrade-btn" onclick="buyUpgrade('click')" id="clickBtn">
                    500 VISA
                </button>
            </div>
            <div class="upgrade-item">
                <div>
                    <div style="font-weight: bold;">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
                    <div style="font-size: 12px;">–ú–∞–∫—Å: <span id="maxEnergy">50</span></div>
                </div>
                <button class="upgrade-btn" onclick="buyUpgrade('energy')" id="energyBtn">
                    800 VISA
                </button>
            </div>
            <div class="upgrade-item">
                <div>
                    <div style="font-weight: bold;">üéÅ –®–∞–Ω—Å –ø–æ–¥–∞—Ä–∫–∞</div>
                    <div style="font-size: 12px;">–¢–µ–∫—É—â–∏–π: <span id="giftChanceValue">0.5%</span></div>
                </div>
                <button class="upgrade-btn" onclick="buyUpgrade('chance')" id="chanceBtn">
                    1200 VISA
                </button>
            </div>
        </div>
        
        <!-- –ú–µ–Ω—é -->
        <div class="menu">
            <button class="menu-btn" onclick="showSection('inventory')">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="menu-btn" onclick="showSection('top')">üèÜ –¢–æ–ø</button>
            <button class="menu-btn" onclick="showSection('referral')">üë• –†–µ—Ñ–µ—Ä–∞–ª—ã</button>
            <button class="menu-btn" onclick="showSection('stats')">üìä –°—Ç–∞—Ç—ã</button>
            <button class="menu-btn" onclick="openShop()">üè™ –ú–∞–≥–∞–∑–∏–Ω</button>
            <button class="menu-btn" onclick="openFortune()">üé° –ö–æ–ª–µ—Å–æ</button>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
        <div class="section" id="inventorySection">
            <h3>üéí –ò–ù–í–ï–ù–¢–ê–†–¨</h3>
            <div style="text-align: center; padding: 20px;">
                <div style="font-size: 40px; margin: 15px 0;">üéÅ</div>
                <h4>–ü–æ–¥–∞—Ä–∫–æ–≤: <span id="totalGifts">0</span></h4>
                <p style="margin: 10px 0; opacity: 0.8;">–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ!</p>
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è —Ç–æ–ø–∞ -->
        <div class="section" id="topSection">
            <h3>üèÜ –¢–û–ü –ò–ì–†–û–ö–û–í</h3>
            <div id="topList" style="padding: 10px;">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ -->
        <div class="section" id="referralSection">
            <h3>üë• –†–ï–§–ï–†–ê–õ–´</h3>
            <div style="text-align: center; padding: 15px;">
                <p>–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ –∏ –ø–æ–ª—É—á–∏ 100 VISA!</p>
                <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin: 10px 0; font-size: 14px;">
                    https://polypacker1-netizen.github.io/clickergame/?ref=<span id="userRefCode">000</span>
                </div>
                <button class="menu-btn" onclick="copyRefLink()" style="margin-top: 10px;">
                    üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                </button>
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div class="section" id="statsSection">
            <h3>üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê</h3>
            <div style="padding: 10px;">
                <div>–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤: <span id="statClicks">0</span></div>
                <div>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ VISA: <span id="statVisa">0</span></div>
                <div>–ú–∞–∫—Å. —ç–Ω–µ—Ä–≥–∏—è: <span id="statEnergy">50</span></div>
                <div>–†–µ—Ñ–µ—Ä–∞–ª–æ–≤: <span id="statRefs">0</span></div>
                <div>–í—Ä–µ–º—è –∏–≥—Ä—ã: <span id="statTime">0 –º–∏–Ω</span></div>
            </div>
        </div>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        let gameData = {
            username: '',
            visa: 50,
            level: 1,
            xp: 0,
            xpNeeded: 100,
            energy: 50,
            maxEnergy: 50,
            totalClicks: 0,
            gifts: 0,
            referrals: 0,
            clickPower: 5,
            giftChance: 0.005, // 0.5%
            upgrades: {
                click: { level: 1, cost: 500 },
                energy: { level: 1, cost: 800 },
                chance: { level: 1, cost: 1200 }
            },
            lastEnergyUpdate: Date.now(),
            referralCode: '',
            startTime: Date.now()
        };
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–∞ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const refCode = urlParams.get('ref');
        
        // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotify(text, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = text;
            notification.style.background = type === 'error' ? '#ff3838' : '#e94560';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function registerUser() {
            const usernameInput = document.getElementById('usernameInput');
            const username = usernameInput.value.trim();
            const errorDiv = document.getElementById('usernameError');
            
            errorDiv.style.display = 'none';
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∏
            if(!username) {
                errorDiv.textContent = '–í–≤–µ–¥–∏ –Ω–∏–∫–Ω–µ–π–º!';
                errorDiv.style.display = 'block';
                usernameInput.focus();
                return;
            }
            
            if(username.length < 3) {
                errorDiv.textContent = '–ù–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 3 —Å–∏–º–≤–æ–ª–æ–≤';
                errorDiv.style.display = 'block';
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∏–∫ –≤ localStorage
            const existingUsers = JSON.parse(localStorage.getItem('visaclicker_users') || '{}');
            
            if(existingUsers[username.toLowerCase()]) {
                errorDiv.textContent = '–≠—Ç–æ—Ç –Ω–∏–∫ —É–∂–µ –∑–∞–Ω—è—Ç!';
                errorDiv.style.display = 'block';
                return;
            }
            
            // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º
            const referralCode = Math.random().toString(36).substr(2, 6).toUpperCase();
            
            gameData.username = username;
            gameData.referralCode = referralCode;
            gameData.startTime = Date.now();
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            existingUsers[username.toLowerCase()] = {
                visa: gameData.visa,
                level: gameData.level,
                referrals: gameData.referrals,
                clicks: gameData.totalClicks,
                gifts: gameData.gifts,
                registered: Date.now()
            };
            
            localStorage.setItem('visaclicker_users', JSON.stringify(existingUsers));
            localStorage.setItem('visaclicker_current_user', JSON.stringify(gameData));
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUI();
            loadTopPlayers();
            
            showNotify(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${username}!`);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
        function handleClick() {
            if(gameData.energy <= 0) {
                showNotify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–Ω–µ—Ä–≥–∏–∏!', 'error');
                return;
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            const clickArea = document.getElementById('clickArea');
            clickArea.style.transform = 'scale(0.95)';
            setTimeout(() => clickArea.style.transform = 'scale(1)', 100);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            gameData.totalClicks++;
            gameData.visa += gameData.clickPower;
            gameData.xp += 2;
            
            // –≠–Ω–µ—Ä–≥–∏—è (1 –Ω–∞ 10 –∫–ª–∏–∫–æ–≤)
            if(gameData.totalClicks % 10 === 0) {
                gameData.energy = Math.max(0, gameData.energy - 1);
            }
            
            // –£—Ä–æ–≤–µ–Ω—å
            if(gameData.xp >= gameData.xpNeeded) {
                gameData.level++;
                gameData.xp = 0;
                gameData.xpNeeded = Math.floor(gameData.xpNeeded * 1.5);
                showNotify(`üéâ –£—Ä–æ–≤–µ–Ω—å ${gameData.level}!`);
            }
            
            // –®–∞–Ω—Å –ø–æ–¥–∞—Ä–∫–∞ (0.5%)
            if(Math.random() < gameData.giftChance) {
                showGift();
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º
            saveGame();
            updateUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫
        function showGift() {
            const gift = document.getElementById('gift');
            gift.style.display = 'flex';
            gift.style.left = Math.random() * 70 + 15 + '%';
            gift.style.top = Math.random() * 70 + 15 + '%';
            
            showNotify('üéÅ –ü–æ—è–≤–∏–ª—Å—è –ø–æ–¥–∞—Ä–æ–∫!', 'info');
            
            setTimeout(() => {
                if(gift.style.display !== 'none') {
                    gift.style.display = 'none';
                    showNotify('–ü–æ–¥–∞—Ä–æ–∫ –∏—Å—á–µ–∑!', 'error');
                }
            }, 4000);
        }
        
        // –°–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫
        function collectGift() {
            const gift = document.getElementById('gift');
            gift.style.display = 'none';
            
            // –¢–∏–ø –Ω–∞–≥—Ä–∞–¥—ã
            const rand = Math.random();
            
            if(rand < 0.7) {
                // VISA
                const amount = Math.floor(Math.random() * 100) + 50;
                gameData.visa += amount;
                showNotify(`üéÅ +${amount} VISA!`);
            } else if(rand < 0.9) {
                // –£–ª—É—á—à–µ–Ω–∏–µ
                gameData.clickPower++;
                showNotify(`üéÅ –°–∏–ª–∞ –∫–ª–∏–∫–∞ +1!`);
            } else {
                // –ü—Ä–µ–¥–º–µ—Ç
                gameData.gifts++;
                showNotify(`üéÅ –†–µ–¥–∫–∏–π –ø—Ä–µ–¥–º–µ—Ç! –í—Å–µ–≥–æ: ${gameData.gifts}`);
            }
            
            saveGame();
            updateUI();
        }
        
        // –ü–æ–∫—É–ø–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è
        function buyUpgrade(type) {
            const upgrade = gameData.upgrades[type];
            
            if(gameData.visa < upgrade.cost) {
                showNotify('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ VISA!', 'error');
                return;
            }
            
            gameData.visa -= upgrade.cost;
            
            switch(type) {
                case 'click':
                    gameData.clickPower += 2;
                    upgrade.level++;
                    upgrade.cost = Math.floor(upgrade.cost * 2);
                    break;
                    
                case 'energy':
                    gameData.maxEnergy += 10;
                    gameData.energy = gameData.maxEnergy;
                    upgrade.level++;
                    upgrade.cost = Math.floor(upgrade.cost * 1.8);
                    break;
                    
                case 'chance':
                    gameData.giftChance += 0.001;
                    upgrade.level++;
                    upgrade.cost = Math.floor(upgrade.cost * 2.2);
                    break;
            }
            
            saveGame();
            updateUI();
            showNotify('–£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!');
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏
        function updateEnergy() {
            const now = Date.now();
            const timeDiff = (now - gameData.lastEnergyUpdate) / 1000 / 60; // –º–∏–Ω—É—Ç—ã
            
            if(timeDiff > 0) {
                // 50 —ç–Ω–µ—Ä–≥–∏–∏ –∑–∞ 20 –º–∏–Ω—É—Ç
                const energyGain = Math.floor((timeDiff / 20) * gameData.maxEnergy);
                if(energyGain > 0) {
                    gameData.energy = Math.min(gameData.maxEnergy, gameData.energy + energyGain);
                    gameData.lastEnergyUpdate = now;
                }
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        function saveGame() {
            localStorage.setItem('visaclicker_current_user', JSON.stringify(gameData));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –æ–±—â–µ–º —Å–ø–∏—Å–∫–µ
            const existingUsers = JSON.parse(localStorage.getItem('visaclicker_users') || '{}');
            if(existingUsers[gameData.username.toLowerCase()]) {
                existingUsers[gameData.username.toLowerCase()].visa = gameData.visa;
                existingUsers[gameData.username.toLowerCase()].level = gameData.level;
                existingUsers[gameData.username.toLowerCase()].referrals = gameData.referrals;
                existingUsers[gameData.username.toLowerCase()].clicks = gameData.totalClicks;
                existingUsers[gameData.username.toLowerCase()].gifts = gameData.gifts;
                localStorage.setItem('visaclicker_users', JSON.stringify(existingUsers));
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            updateEnergy();
            
            // –ù–∏–∫–Ω–µ–π–º
            document.getElementById('displayUsername').textContent = gameData.username;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('visaCount').textContent = gameData.visa;
            document.getElementById('levelCount').textContent = gameData.level;
            document.getElementById('clicksCount').textContent = gameData.totalClicks;
            document.getElementById('giftsCount').textContent = gameData.gifts;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å
            const xpPercent = (gameData.xp / gameData.xpNeeded) * 100;
            document.getElementById('xpBar').style.width = xpPercent + '%';
            document.getElementById('xpText').textContent = `${gameData.xp}/${gameData.xpNeeded}`;
            
            // –≠–Ω–µ—Ä–≥–∏—è
            const energyPercent = (gameData.energy / gameData.maxEnergy) * 100;
            document.getElementById('energyBar').style.width = energyPercent + '%';
            document.getElementById('energyText').textContent = `${gameData.energy}/${gameData.maxEnergy}`;
            
            // –ó–Ω–∞—á–µ–Ω–∏—è
            document.getElementById('powerValue').textContent = `x${gameData.clickPower}`;
            document.getElementById('chanceValue').textContent = (gameData.giftChance*100).toFixed(2) + '%';
            
            // –£–ª—É—á—à–µ–Ω–∏—è
            document.getElementById('clickPower').textContent = gameData.clickPower;
            document.getElementById('maxEnergy').textContent = gameData.maxEnergy;
            document.getElementById('giftChanceValue').textContent = (gameData.giftChance*100).toFixed(2) + '%';
            
            // –ö–Ω–æ–ø–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π
            document.getElementById('clickBtn').textContent = gameData.upgrades.click.cost + ' VISA';
            document.getElementById('energyBtn').textContent = gameData.upgrades.energy.cost + ' VISA';
            document.getElementById('chanceBtn').textContent = gameData.upgrades.chance.cost + ' VISA';
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥
            document.getElementById('clickBtn').disabled = gameData.visa < gameData.upgrades.click.cost;
            document.getElementById('energyBtn').disabled = gameData.visa < gameData.upgrades.energy.cost;
            document.getElementById('chanceBtn').disabled = gameData.visa < gameData.upgrades.chance.cost;
            
            // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
            document.getElementById('totalGifts').textContent = gameData.gifts;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const playTime = Math.floor((Date.now() - gameData.startTime) / 1000 / 60);
            document.getElementById('statClicks').textContent = gameData.totalClicks;
            document.getElementById('statVisa').textContent = gameData.visa;
            document.getElementById('statEnergy').textContent = gameData.maxEnergy;
            document.getElementById('statRefs').textContent = gameData.referrals;
            document.getElementById('statTime').textContent = playTime + ' –º–∏–Ω';
            
            // –†–µ—Ñ–µ—Ä–∞–ª—ã
            document.getElementById('userRefCode').textContent = gameData.referralCode;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø–∞
        function loadTopPlayers() {
            const existingUsers = JSON.parse(localStorage.getItem('visaclicker_users') || '{}');
            const topList = document.getElementById('topList');
            
            if(Object.keys(existingUsers).length === 0) {
                topList.innerHTML = '<p style="text-align: center; opacity: 0.7;">–ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ VISA
            const usersArray = Object.entries(existingUsers)
                .map(([username, data]) => ({ username, ...data }))
                .sort((a, b) => b.visa - a.visa);
            
            let html = '';
            const medals = ['ü•á', 'ü•à', 'ü•â', '4.', '5.'];
            
            usersArray.slice(0, 5).forEach((user, index) => {
                html += `
                    <div style="background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin: 5px 0; display: flex; justify-content: space-between;">
                        <div>
                            <span>${medals[index] || (index+1+'.')}</span>
                            <span style="margin-left: 8px; font-weight: bold;">${user.username}</span>
                        </div>
                        <div style="color: #ffd700;">
                            ${user.visa} VISA
                        </div>
                    </div>
                `;
            });
            
            topList.innerHTML = html;
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é
        function showSection(section) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ
            ['inventory', 'top', 'referral', 'stats'].forEach(sec => {
                document.getElementById(sec + 'Section').style.display = 'none';
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é
            document.getElementById(section + 'Section').style.display = 'block';
            
            if(section === 'top') {
                loadTopPlayers();
            }
        }
        
        // –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã
        function openFortune() {
            showNotify('üé° –ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã —Å–∫–æ—Ä–æ!');
        }
        
        // –ú–∞–≥–∞–∑–∏–Ω
        function openShop() {
            showNotify('üè™ –ú–∞–≥–∞–∑–∏–Ω –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!');
        }
        
        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É
        function copyRefLink() {
            const link = `https://polypacker1-netizen.github.io/clickergame/?ref=${gameData.referralCode}`;
            navigator.clipboard.writeText(link);
            showNotify('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∏–≥—Ä—ã
        window.onload = function() {
            const savedUser = localStorage.getItem('visaclicker_current_user');
            
            if(savedUser) {
                try {
                    gameData = JSON.parse(savedUser);
                    document.getElementById('loginModal').style.display = 'none';
                    document.getElementById('gameInterface').style.display = 'block';
                    updateUI();
                    loadTopPlayers();
                } catch(e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
            setInterval(updateUI, 60000);
            
            // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(saveGame, 30000);
        };
    </script>
</body>
</html>
